---
description: Project infrastructure decisions and setup conventions for ESLint plugins with TypeScript
globs: ["**/*"]
alwaysApply: true
---

# Project Infrastructure

This document captures infrastructure decisions for an ESLint plugin written in TypeScript.

## Node.js & Package Manager

- **Node.js**: Minimum version 24 (Current)
- **Package Manager**: npm (standard, no lock file preference)
- **Module System**: ESM (`"type": "module"` in package.json)

## TypeScript Configuration

### Compiler Options (Strict Mode)

```json
{
  "compilerOptions": {
    "target": "ES2024",
    "module": "NodeNext",
    "moduleResolution": "NodeNext",
    "strict": true,
    "strictNullChecks": true,
    "strictFunctionTypes": true,
    "strictBindCallApply": true,
    "strictPropertyInitialization": true,
    "noImplicitAny": true,
    "noImplicitThis": true,
    "noImplicitReturns": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedIndexedAccess": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "exactOptionalPropertyTypes": true,
    "forceConsistentCasingInFileNames": true,
    "verbatimModuleSyntax": true
  }
}
```

### Key Decisions

- **`noUncheckedIndexedAccess`**: Enables strict array/object index access, preventing undefined access bugs
- **`exactOptionalPropertyTypes`**: Distinguishes between `undefined` and missing properties
- **`verbatimModuleSyntax`**: Enforces explicit type imports, ensuring clean ESM output

## ESLint Configuration

### Using ESLint 9 Flat Config with TypeScript

The project uses `typescript-eslint` v8+ with the new flat config format (array-style, not deprecated `tseslint.config()`).

```ts
import eslint from "@eslint/js";
import tseslint from "typescript-eslint";

export default [
  eslint.configs.recommended,
  ...tseslint.configs.strictTypeChecked,
  ...tseslint.configs.stylisticTypeChecked,
  {
    languageOptions: {
      parserOptions: {
        projectService: {
          allowDefaultProject: ["*.config.ts"],
        },
        tsconfigRootDir: import.meta.dirname,
      },
    },
  },
];
```

### Required Dev Dependencies for ESLint + TypeScript

```json
{
  "@eslint/js": "^9.x",
  "eslint": "^9.x",
  "jiti": "^2.x",
  "typescript-eslint": "^8.x"
}
```

Note: `jiti` is required by ESLint 9 for loading TypeScript config files (`eslint.config.ts`).

### Key Rules Enabled

- `@typescript-eslint/explicit-function-return-type`: All functions must have explicit return types
- `@typescript-eslint/consistent-type-imports`: Use `type` keyword for type-only imports
- `@typescript-eslint/consistent-type-definitions`: Prefer `interface` over `type` aliases
- `@typescript-eslint/no-unnecessary-condition`: Catch always-truthy/falsy conditions
- `@typescript-eslint/strict-boolean-expressions`: No implicit boolean coercion

## Prettier Configuration

### Settings (2-Space Indentation)

```json
{
  "semi": true,
  "singleQuote": false,
  "tabWidth": 2,
  "useTabs": false,
  "trailingComma": "es5",
  "printWidth": 100,
  "bracketSpacing": true,
  "arrowParens": "always",
  "endOfLine": "lf"
}
```

### Key Decisions

- **2 spaces**: Standard for JavaScript/TypeScript ecosystem
- **Double quotes**: Aligns with JSON, cleaner for strings containing apostrophes
- **100 character line width**: Balances readability and modern screen sizes
- **Trailing commas (ES5)**: Cleaner diffs, supported in all target environments
- **LF line endings**: Unix-style, consistent across platforms

## Testing

### Test Framework: Vitest

- Fast, native TypeScript support
- Jest-compatible API
- Uses `@typescript-eslint/rule-tester` for ESLint rules

### Test File Location

- Tests co-located with source: `src/**/*.test.ts`
- No separate `__tests__` directory

## Project Structure

```
├── src/
│   ├── index.ts              # Plugin entry point
│   ├── rules/                # ESLint rule implementations
│   │   ├── rule-name.ts
│   │   └── rule-name.test.ts
│   └── utils/                # Shared utilities
├── dist/                     # Build output (gitignored)
├── docs/                     # Documentation
├── eslint.config.ts          # ESLint flat config
├── tsconfig.json             # TypeScript config
├── vitest.config.ts          # Vitest config
└── .prettierrc               # Prettier config
```

## NPM Scripts

- `npm run build` - Compile TypeScript
- `npm run dev` - Watch mode compilation
- `npm run lint` - Run ESLint
- `npm run lint:fix` - Run ESLint with auto-fix
- `npm run format` - Format with Prettier
- `npm run format:check` - Check formatting
- `npm run test` - Run tests
- `npm run test:watch` - Run tests in watch mode
- `npm run typecheck` - Type-check without emitting
